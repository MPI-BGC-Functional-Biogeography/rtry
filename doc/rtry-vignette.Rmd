---
title: "rtry vignettes"
output:
  rmarkdown::html_vignette:
    toc: true
    number_sections: true
    toc_depth: 3
vignette: >
  %\VignetteIndexEntry{rtry vignettes}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


***


# The TRY database

The TRY database (https://www.try-db.org) is a Plant Trait Database operated since 2007 with the incentive to improve the availability and accessibility of plant trait data for ecology and earth system sciences. Since then, the TRY database has grown continuously and is now providing unprecedented data coverage under an open access data policy for research community worldwide.

In 2014, the TRY database was made publicly available through the implementation of the TRY Data Portal (https://www.try-db.org/TryWeb/dp.php). This Portal organizes data uploads, searches and requests, and enables interaction between data contributors, management and users. At the same time, it provides a link to the TRY File Archive (https://www.try-db.org/TryWeb/Data.php), which offers climate and soil data for TRY measurement sites, standardized categorical traits relevant to attribute species to plant functional types (PFTs), and provides the opportunity to publish plant trait data sets and receive a DOI. (For details related data request, please refer to the 'Request data from the TRY database' section below.)

The TRY database version 5 released on 26 March 2019, contained 387 data sets providing 11.8 million trait records, accompanied by 35 million ancillary data, for 2091 traits and 280000 plant taxa, mostly at the species level. Our team at the Max Planck Institute for Biogeochemistry (MPI-BGC) is currently working towards the release of version 6.

<br>

## Column headers

Through the TRY Data Portal, the trait data is provided as zipped text file (`.txt`) with `Latin-1` encoding. In version 5, there are 27 tab-delimited columns in the provided data, which is indicated as header in the first row of the text file.



|      | Column         | Comment                                                      |
| ---- | -------------- | ------------------------------------------------------------ |
| 1.   | LastName       | Surname of data contributor                                  |
| 2.   | FirstName      | First name of data contributor                               |
| 3.   | DatasetID      | Unique identifier of contributed dataset                     |
| 4.   | Dataset        | Name of contributed dataset                                  |
| 5.   | SpeciesName    | Original name of species                                     |
| 6.   | AccSpeciesID   | Unique identifier of consolidated species name               |
| 7.   | AccSpeciesName | Consolidated species name                                    |
| 8.   | ObservationID  | Unique identifier for each observation                       |
| 9.   | ObsDataID      | Unique identifier for each record                            |
| 10.  | TraitID        | Unique identifier for traits (only if the record is a trait) |
| 11.  | TraitName             | Name of trait (only if the record is a trait)                |
| 12.  | DataID                | Unique identifier for each sub-trait or context information  |
| 13.  | DataName              | Name of sub-trait or context information                     |
| 14.  | OriglName             | Original name of sub-trait or context information            |
| 15.  | OrigValueStr          | Original value as text string                                |
| 16.  | OrigUnitStr           | Original unit as text string                                 |
| 17.  | ValueKindName         | Value kind (single measurement, mean, median, etc.)          |
| 18.  | OrigUncertaintyStr    | Original uncertainty as text string                          |
| 19.  | UncertaintyName       | Kind of uncertainty (standard deviation, standard error, etc.) |
| 20.  | Replicates            | Count of replicates                                          |
| 21.  | StdValue              | Standardized value: available for standardized traits        |
| 22.  | UnitName              | Standard unit: available for standardized traits             |
| 23.  | RelUncertaintyPercent | Relative uncertainty in %                                    |
| 24.  | OrigObsDataID         | Unique identifier for duplicate entries                      |
| 25.  | ErrorRisk             | Indication for outliers: distance to mean in standard deviations |
| 26.  | Reference             | Reference to be cited if trait record is used in analysis    |
| 27.  | Comment               | Explanation for the `OriginalName` in the contributed dataset |

Note that sometimes R may show a column 28, which should be empty. This column is an artefact due to the different software (MySQL >> R).

<br>

## Request data from the TRY database

As said, the TRY database was made publicly available through the implementation of the TRY Data Portal (https://www.try-db.org/TryWeb/dp.php) in 2014. Anyone can register online and granted access rights for requesting data from the database.

The data available from the TRY database is licensed under a CC BY license (Creative Commons Attribution), i.e. the data are publicly available without restriction and the user is free to share and adapt the data, under the only conditions to give appropriate credit, provide a link to the license, and indicate if changes were made. Whereas for unpublished data, the opportunity of a 2(+2) years embargo period with restricted access is provided.

To give users a general overview of the TRY database, the Data Explorer provides information about the content of the TRY database with respect to traits, species, original datasets and regions.

![request_data_explorer](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\request_data_explorer.png){width=100%}

<br>

### Self registration

#### Sign Up

In order to request data from the TRY Data Portal, first-time users have to create a user account. This self-registration for the TRY database can be performed by the user following a few simple steps:

1. Click on the 'Registration' on the header menu of the [TRY Data Portal](https://www.try-db.org/TryWeb/dp.php), which would then lead to the 

   ![request_data_registration_01](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\request_data_registration_01.png){width=100%}

   

2. Fill in the registration form as instructed and click on 'Submit'. Note that the plant on the right side of the header will change randomly when the page is refreshed.

   ![request_data_registration_02](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\request_data_registration_02.png){width=100%}

   

3. If everything goes well, the user will be re-directed to the 'Registration was successful!' page. In the meantime, a system generated email that contains the login password will be sent to the registered email address.

   Using the provided password, user can login to the TRY Data Portal with the full email address (used during registration) as username.

   Note that it is advised to change the password when user first receive the password. To do so, simply click the 'Change password' on the header menu and follow the instructions.



#### Login

Once registered, users can access restricted content and request data from the data portal by entering the full email address as username and the password.



#### Reset password

In case the password has been forgotten, users can reset the password by clicking the 'Reset Password' on the header menu. Follow the instructions and a new password will be created automatically by the system and sent to the email address provided (which should be the same as the registered email address, i.e. username).

![request_data_registration_03](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\request_data_registration_03.png){width=100%}

The user can then login to the data portal using the new password. Again, it is advised to change the password when the user receive the new password using the 'Change password' option.

<br>

### Data request

On the TRY Data Portal, there are two data request options: (1) TRY Database and (2) TRY File Archive.

In the context of the TRY Database (https://www.try-db.org/TryWeb/Prop0.php), the trait values were standardized, quality checked and made available upon request. The data format that the users will receive would be in `.txt` format.

On the other hand, the TRY File Archive (https://www.try-db.org/TryWeb/Data.php) hosts on the TRY website is a repository for the plant traits datasets complementary to the TRY database, and the datasets are stored and released as contributed (mostly in `.xlsx` format).

Since the `rtry` package focuses on the standardized TRY data (`.txt`), this section will only describe how to request data from the TRY Database.



1. To request the standardize and quality checked data from the TRY Database, click on the "TRY Database" button.
   ![request_data_gui](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\request_data_gui.png){width=100%}

   

2. Users are then re-directed to the page as shown below and are recommended to read the "Intellectual Property Guidelines" and the document that describes the format of the released data first before continuing. These two documents will also be provided alongside with the requested data when released.

   There are two ways to request data from the TRY database, by traits/species or by database. It is recommended to use the "Request by traits/species" option.

   ![request_data_database_01](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\request_data_database_01.png){width=100%}

   

3. Once the "Request by traits/species" button is clicked, the login dialog is prompted if the users have not login. Enter the registered email address as username and the password as credentials.

   

4. Next, users are re-directed to the "Intellectual Property Guidelines for the TRY Plant Trait Database" page. Read the guidelines carefully and then click "accept" to continue.
   ![request_data_database_02](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\request_data_database_02.png){width=100%}

   

5. Users are then asked to select the traits they would like to select.

   On this page, the users can see all the available traits and their respective `TraitID`s by clicking the "Show Traits" button; whereas on the right hand side, they can see if there are any refinements made to the traits.

   As stated on the instructions, users can request multiple traits data by entering the respective `TraitID`s (separated by commas) in the box provided then click "Continue".

   ![request_data_database_03](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\request_data_database_03.png){width=100%}

   

6. Users are then re-directed to the page where they could double-check if they have selected all the necessary traits. Next, they could continue the selection process by clicking on the "Continue to species list" button, or complete the process without selecting any species.
   ![request_data_database_04](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\request_data_database_04.png){width=100%}

   

7. On this next page, users can right click on the link and save the up-to-date species list to have an overview of the available species. Then, they can request multiple species data by entering the respective `AccSpeciesID`s (separated by commas) in the box provided.
   ![request_data_database_05](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\request_data_database_05.png){width=100%}

   

8. Again, users are re-directed to the page where they could double-check if they have selected all the necessary species before continuing.
   ![request_data_database_06](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\request_data_database_06.png){width=100%}

   

9. If all the requested traits and species are public, information of the requested data will be displayed on this next page, showing how many traits and species the users had selected, as well as how many trait measurements will be included in the request data. The users will also have one last chance to update the selected traits and species underneath before continuing the data request process.
   ![request_data_database_07](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\request_data_database_07.png){width=100%}

   

   If the requested traits or species included restricted data, the option to choose whether to request "restricted and public" or "public only" will be provided. Note that it could take up to 14 days to release the restricted data to users as stated on the page.
   ![request_data_database_08](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\request_data_database_08.png){width=100%}

   

10. The users are then given the opportunity to provide some information of the project for which they are requesting the data for. Such information will also be used to convince contributors of datasets temporarily under embargo to make their data available for the request in case restricted data are included.
    ![request_data_database_09](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\request_data_database_09.png){width=100%}

    

11. The data request ID will be provided on the next page, with the information where to access the requested data once it is released. Note that the data request is not finished so it is important to continue the steps.
    ![request_data_database_10](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\request_data_database_10.png){width=100%}

    

12. Users can add coauthors of the project by providing their email addresses and following the instructions. Once the users have finished entering the coauthors, they can submit the request to the TRY Database by clicking the "Finish" button.
    ![request_data_database_11](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\request_data_database_11.png){width=100%}

    

13. As stated on the last page of the data request process, an automatic system email is then sent to the registered email address that the data request is completed. Inside this email, the information such as data request ID, title of the project, a list of coauthors, and the selected traits and species are provided as reference.

    Users will have to wait for the data to be released, by then they will be informed by another email notification automatically generated by the TRY Data Portal.
    ![request_data_database_12](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\request_data_database_12.png){width=100%}

<br>

### Data retrieve

Once the requested data has been released, the users requesting the data (known as PI) will be notified by via email. Click on the link provided in the email or in case users would like to retrieve the previously released data from the TRY Data Portal, simply follow the steps below.



1. To retrieve released data, click on the "Request PI Center" button.
   ![retrieve_data_gui](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\retrieve_data_gui.png){width=100%}

   

2. For any data requested via the TRY database, once released can be downloaded under the area "Requests - Download Data". The users can simply select the data request ID they wish to download and click "Go". Note that users are required to cite the TRY reference when using the requested data.
   ![retrieve_data_database_01](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\retrieve_data_database_01.png){width=100%}

   

3. Users will then redirected to the page where they could click the "download" and save the `.zip` file locally on their machine. Inside, users can find three files: (1) a `.txt` with the request data ID as file name, which contains all the trait measurements as requested, (2) the "Intellectual Property Guidelines for the TRY Plant Trait Database" in `.pdf` format, and (3) the "Data Release Notes" for the TRY data in `.pdf` format which describes the format of the released data.
   ![retrieve_data_database_02](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\retrieve_data_database_02.png){width=100%}

   

4. The "Request PI Center" also provides a summary for users to keep track of the requested data. To check the summary, click the "Show Request Summaries".
   ![retrieve_data_database_03](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\retrieve_data_database_03.png){width=100%}

   

5. The users will then re-directed to another page where all the requested data (either released or not released) can be seen. One important remarks is that the version of the TRY data is also provided in this summary.
   ![retrieve_data_database_04](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\retrieve_data_database_04.png){width=100%}

<br>

---

# The TRY R project (`rtry`)

Due to the unique long table structure, the TRY data must be pre-processed in a way such that it is easy to handle and understand before analysis. The `rtry` package for `R` provides a set of functions to facilitate the pre-process the TRY data, that allows users who are not familiar with the `R` programming language or the TRY dataset structure to easily prepare the data for further analysis.

<br>

## Installation guide for the `rtry` package

### R environment

R 4.0.3 was used to develop and build the `rtry` package, and this is the minimum version required to use the package. It is also recommended to use the latest version of RStudio when using the package.

The latest version of R can be downloaded from CRAN, a network of ftp and web servers around the world that store the code and documentation of R: https://cran.r-project.org/

The released version of RStudio, an integrated development environment (IDE) designed for productive R programming, can be found at https://rstudio.com/products/rstudio/download/, it is sufficient to use the free and open source version of RStudio Desktop.

<br>

### Download the `rtry` package

The source package and documentation of the `rtry` package can be downloaded from the Nextcloud operated by MPI-BGC. 

- Link: https://nextcloud.bgc-jena.mpg.de/s/RMd5kqg7tRWXpae
- Password: `mpi-bgc-rtry`

Once the download is completed, extract the folder to a desired location.

<br>

#### Overview of the file structure

```markdown
.
├── build				# Source files for the rtry package
│   ├── rtry_x.x.x.xxxx	# Source package
├── docs				# Documentation files
├── examples				# Scripts of example workflow
│   ├── input				# Input files needed for testing
└── README.md
```

Note: If user wishes to try out the package with the provided example scripts, it is advised to download the entire directory and maintain the file structure.

<br>

### Install `rtry` package

The installation of the `rtry` package can be performed through the RStudio console.



First, install all the dependencies with the command.

```R
install.packages(c("data.table", "dplyr", "tidyr", "jsonlite", "curl"))
```

Once installation is completed, the message `The downloaded source packages are in <path>` should be seen.



Next, install the `rtry` package with the command:

```R
install.packages("<path_to_rtry.tar.gz>", repos = NULL, type = "source")
```

Note: The character `\` is used as escape character in R to give the following character special meaning (e.g. `\n` for newline, `\t` for tab, `\r` for carriage return and so on). Therefore, for Windows users, it is important to replace the `\` in the file path with `/` in order for R to correctly understand the input path.

You may ignore the warning message `Rtools is required to build R packages but is not currently installed` if appears. A successful installation leads to a similar output:

```R
## * installing *source* package 'rtry' ...
## ** using staged installation
## ** R
## ** inst
## ** byte-compile and prepare package for lazy loading
## ** help
## *** installing help indices
##   converting help for package 'rtry'
##     finding HTML links ... done
##     rtry_bind_col                           html  
##     rtry_bind_row                           html  
##     rtry_explore                            html  
##     rtry_export                             html  
##     rtry_filter                             html  
##     rtry_filter_keyword                     html  
##     rtry_geocoding                          html  
##     rtry_import                             html  
##     rtry_revgeocoding                       html  
##     rtry_rm_col                             html  
##     rtry_rm_dup                             html  
##     rtry_select_col                         html  
##     rtry_select_row                         html  
##     rtry_trans_wider                        html  
## ** building package indices
## ** installing vignettes
## ** testing if installed package can be loaded from temporary location
## *** arch - i386
## *** arch - x64
## ** testing if installed package can be loaded from final location
## *** arch - i386
## *** arch - x64
## ** testing if installed package keeps a record of temporary installation path
## * DONE (rtry)
```



Once installation is completed, the `rtry` package can be loaded with the command:

```R
library(rtry)
```

<br>

### Try out example workflow

To assist first-time user, several example workflows have been developed and provided in different formats:

- vignettes, that comes along with the `rtry` package without additional download, acts as a guideline for users to follow
- R Markdown scripts (`.Rmd`) and HTML files (`.html`), located inside the `examples` directory can be downloaded from the link provided at the beginning of this Section, allows users to run the example scripts directly and compare the expected results in the browser

The required sample data is also provided within the package and inside the `examples/input` directory. In order to run the code smoothly, make sure the script is place inside a folder in which the sample data is saved inside the `input` folder. This can be done manually or achieved simply by downloading the entire `examples` directory.

![example_workflow_file_structure](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\example_workflow_file_structure.png){width=70%}



To try out the example workflow, open the `.Rmd` (e.g. `general_workflow_using_rtry.Rmd`). Then, make sure the work directory is set to the location where the directory is located:

```R
setwd("<path_to_rtry_examples_dir>")
```



Once the script (`.Rmd`) is opened, you will be able to see that the source code had been divided into different chunks (i.e. the grey blocks) with descriptions and comments explaining each step.

To execute the code in a particular chunk, simply press the corresponding green arrow on the top right of that chunk, or place your cursor within that chunk then press `Ctrl+Shift+Enter`. This way only the code included within the chunk is executed, and users can easily modify and re-execute different steps.

Also, the output or feedback of the executed code will be displayed directly below the chunk, allowing easy trace back.

![example_workflow_run_block](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\example_workflow_run_block.png){width=90%}

Note: The expected results could be viewed in the corresponding `.html` file.

<br>

### Update `rtry` package

To update the `rtry` package to a newer version, simply restart RStudio and use the same installation command:

```R
# Remember to restart RStudio first
install.packages("<path_to_rtry.tar.gz>", repos = NULL, type = "source")
```

You may ignore the warning message `Rtools is required to build R packages but is not currently installed` if appears.

<br>

### Other useful commands

#### Check `rtry` version

To check the version of the loaded `rtry` package:

```R
packageVersion("rtry")
```

<br>

#### Obtain documentations of the entire `rtry` package

To get an overview of the `rtry` package and the corresponding documentations:

```R
??rtry
```

<br>

#### Obtain documentation for a specific function or data

Inside the `rtry` package, each function has its corresponding documentation providing a brief description of the function, and explanation for each argument. For the documentation of a specific function, such as `rtry_import()`, type a `?` in front of the function name:

```R
?rtry_import
```



Several sample data has been provided within the `rtry` package, to obtain the documentation of the data such as `locations`, use the following command:

```R
?locations
```

<br>

#### Obtain vignettes of the package

To open a list of vignettes for the `rtry` package:

```R
browseVignettes("rtry")
```



To directly view a vignette (e.g. `rtry-vignette`) of the `rtry` package from the `Help` panel:

```R
vignette("rtry-vignette")
```

<br>

---

# The `rtry` package

Inside the `rtry` package, function naming convention where each function begins with the prefix `rtry_` followed by the description of what the specific function does.

- `rtry_import`
- `rtry_explore`
- `rtry_bind_col`
- `rtry_bind_row`
- `rtry_merge_col`
- `rtry_merge_row`
- `rtry_select_col`
- `rtry_select_row`
- `rtry_select_aux`
- `rtry_filter`
- `rtry_filter_keyword`
- `rtry_rm_col`
- `rtry_rm_dup`
- `rtry_trans_wider`
- `rtry_export`
- `rtry_geocoding`
- `rtry_revgeocoding`

<br>

## `rtry_import`

This function, by default, imports the text file exported from the TRY database as a data.table for further processing. It can also be used to import other data file, such as .csv file with comma as separator.

```R
rtry_import(
  input = "",
  separator = "\t",
  encoding = "Latin-1",
  quote = "",
  showOverview = TRUE
)
```

| Argument       | Description                                                  |
| -------------- | ------------------------------------------------------------ |
| `input`        | Path to the text file downloaded from TRY                    |
| `separator`    | Data separator. Default `"\t"` for the TRY data output       |
| `encoding`     | File encoding. Default `"Latin-1"`                           |
| `quote`        | Default `""` reads the fields as is. If the fields start with a double quote, use `"\""` instead |
| `showOverview` | Default `TRUE` displays the input path, dimension and column names of the input data |



**Example 1**

To import the file `"input/7956.txt"` for preprocessing:

```R
TRYdata1 <- rtry_import("input/7956.txt")
```

```R
## input:  input/7956.txt 
## dim:    306234 28 
## col:   LastName FirstName DatasetID Dataset SpeciesName AccSpeciesID AccSpeciesName ObservationID ObsDataID TraitID TraitName DataID DataName OriglName OrigValueStr OrigUnitStr ValueKindName OrigUncertaintyStr UncertaintyName Replicates StdValue UnitName RelUncertaintyPercent OrigObsDataID ErrorRisk Reference Comment V28 
```

Since the default value of `showOverview` is set to be `TRUE`, the overview of the data would be displayed in the console despite the argument `showOverview = TRUE` is not specified. The return data was assigned to the variable `TRYdata1`.



**Example 2**

To import previously saved CSV file from `rtry` for further analysis:

```R
input_locations <- rtry_import("input/locations.csv", separator = ",", encoding = "UTF-8", quote = "\"")
```

```R
## input: input/locations.csv
## dim:   29 3
## col:   Country code Country Location 
```

Since the default value of `showOverview` is set to be `TRUE`, the overview of the data would be displayed in the console despite the argument `showOverview = TRUE` is not specified. The return data was assigned to the variable `input_locations`.

<br>

## `rtry_explore`

This function takes the data table imported by `rtry_import()` and converts it into a grouped data table based on the specified column names. Note the the output data is grouped by the first attribute if not specified using the parameter `sortBy`. To provide a first understanding of the data, an additional column is added to show the total count within each group.

```R
rtry_explore(input = "", ..., sortBy = "", showOverview = TRUE)
```

| Argument       | Description                                                  |
| -------------- | ------------------------------------------------------------ |
| `input`        | Input data, imported by `rtry_import()` or in data table format |
| `...`          | Attribute names to group together                            |
| `sortBy`       | (Optional) Specify the attribute name used to reorder the rows |
| `showOverview` | Default `TRUE` displays the dimension of the result data table |



**Example 1**

To explore the unique values in `TRYdata1` based on the attributes `DataID`, `DataName`, `ObsDataID`, `OrigObsDataID`, and grouped by the first attribute, i.e. `DataID`:

```R
TRYdata1_explore <- rtry_explore(TRYdata1, DataID, DataName, ObsDataID, OrigObsDataID)
```

```R
## dim:    306234 5 
```

Since the default value of `showOverview` is set to be `TRUE`, the dimension of the output data would be displayed in the console despite the argument `showOverview = TRUE` is not specified. The return data was assigned to the variable `TRYdata1_explore`.



**Example 2**

To explore the unique values in `TRYdata2` based on the attributes `AccSpeciesID`, `DataID`, `DataName`, `TraitID` and `TraitName`, and sorted by `DataName`:

```R
TRYdata2_explore_accSpecies <- rtry_explore(TRYdata2, AccSpeciesID, DataID, DataName, TraitID, TraitName, sortBy = DataName, showOverview = FALSE)
```

Since the `showOverview` in this example is set to `FALSE`, the dimension of the output data would not be displayed in the console.

The output `TRYdata2_explore_accSpecies` would look like the following:

![rtry_explore_usecase_3](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\rtry_explore_usecase_3.png){width=70%}

<br>

## `rtry_bind_col`

This function takes a sequence of data imported by `rtry_import()` and combined them by columns. The data should share the same number of rows.

```R
rtry_bind_col(..., showOverview = TRUE)
```

| Argument       | Description                                                  |
| -------------- | ------------------------------------------------------------ |
| `...`          | A sequence of data frame to be combined by columns           |
| `showOverview` | Default `TRUE` displays the dimension and column names of the combined data |

<br>

## `rtry_bind_row`

This function takes a sequence of data imported by `rtry_import()` and combined them by rows. The data should share the same number of columns and column names.

```R
rtry_bind_row(..., showOverview = TRUE)
```

| Argument       | Description                                                  |
| -------------- | ------------------------------------------------------------ |
| `...`          | A sequence of data frame to be combined by rows              |
| `showOverview` | Default `TRUE` displays the dimension and column names of the combined data |



**Example 1**

To combine the data `TRYdata1` and `TRYdata2` together by rows:

```R
TRYdata <- rtry_bind_row(TRYdata1, TRYdata2)
```

```R
## dim:    435764 28 
## col:   LastName FirstName DatasetID Dataset SpeciesName AccSpeciesID AccSpeciesName ObservationID ObsDataID TraitID TraitName DataID DataName OriglName OrigValueStr OrigUnitStr ValueKindName OrigUncertaintyStr UncertaintyName Replicates StdValue UnitName RelUncertaintyPercent OrigObsDataID ErrorRisk Reference Comment V28 
```

Since the default value of `showOverview` is set to be `TRUE`, the dimension and the column names of the combined data would be displayed in the console despite the argument `showOverview = TRUE` is not specified. The return combined data was assigned to the variable `TRYdata`.

<br>

## `rtry_merge_col`

This function merges two data frames based on a specified common column (by default: `ObservationID`) and returns all records from the left data frame (`x`) together with the matched records from the right data frame (`y`) for further processing. In order words, this functions performs a left join on the two provided data frames.

```R
rtry_merge_col(x = "", y = "", baseOn = ObservationID, showOverview = TRUE)
```

| Argument       | Description                                                  |
| -------------- | ------------------------------------------------------------ |
| `x`            | The left data frame, imported by `rtry_import()` or in data table format |
| `y`            | The right data frame, imported by `rtry_import()` or in data table format |
| `baseOn`       | Default `ObservationID`, the common column used for merging  |
| `showOverview` | Default `TRUE` displays the dimension and column names of the data after merging |

<br>

## `rtry_merge_row`

This function merges two data frames based on the row names of the specified common column (by default: `ObservationID`) and returns all rows from both tables, join records from the left (`x`) which have matching keys in the right data frame (`y`) for further processing. In order words, this functions performs a outer join on the two provided data frames, i.e. the join table will contain all records from both the tables.

```R
rtry_merge_row(x = "", y = "", baseOn = ObservationID, showOverview = TRUE)
```

| Argument       | Description                                                  |
| -------------- | ------------------------------------------------------------ |
| `x`            | The left data frame, imported by `rtry_import()` or in data table format |
| `y`            | The right data frame, imported by `rtry_import()` or in data table format |
| `baseOn`       | Default `ObservationID`, the common column used for merging  |
| `showOverview` | Default `TRUE` displays the dimension and column names of the data after merging |

<br>

## `rtry_select_col`

This function selects specified columns from the imported data for further processing. Another alternative to achieve this purpose would be `rtry_rm_col()` where the columns to be removed are specified instead.

```R
rtry_select_col(input = "", ..., showOverview = TRUE)
```

| Argument       | Description                                                  |
| -------------- | ------------------------------------------------------------ |
| `input`        | Input data, imported by `rtry_import()` or in data table format |
| `...`          | Column names to be selected                                  |
| `showOverview` | Default `TRUE` displays the dimension of the selected columns |



**Example 1**

To select (or say extract) the columns `ObsDataID`, `ObservationID`, `AccSpeciesID`, `AccSpeciesName`, `ValueKindName`, `TraitID`, `TraitName`, `DataID`, `DataName`, `OriglName`, `OrigValueStr`, `OrigUnitStr`, `StdValue`, `UnitName`, `OrigObsDataID`, `ErrorRisk`, `Comment` within the `TRYdata`:

```R
TRYdata_selectColumns <- rtry_select_col(TRYdata, ObsDataID, ObservationID, AccSpeciesID, AccSpeciesName, ValueKindName, TraitID, TraitName, DataID, DataName, OriglName, OrigValueStr, OrigUnitStr, StdValue, UnitName, OrigObsDataID, ErrorRisk, Comment)
```

```R
## dim:    435764 17 
## col:   ObsDataID ObservationID AccSpeciesID AccSpeciesName ValueKindName TraitID TraitName DataID DataName OriglName OrigValueStr OrigUnitStr StdValue UnitName OrigObsDataID ErrorRisk Comment 
```

Note that the resulting data table would be the same as in the example provided in `rtry_rm_col()` in this case.

Since the default value of `showOverview` is set to be `TRUE`, the overview of the extracted data would be displayed in the console despite the argument `showOverview = TRUE` is not specified. The return data was assigned to the variable `TRYdata_selectColumns`.



**Example 2**

To select (or extract) neighboring columns, e.g. `TraitID` to `ValueKindName`:

```R
TRYdata_selectNeighborColumns <- rtry_select_col(TRYdata, TraitID:ValueKindName)
```

```R
## dim:   435764 8 
```

![rtry_select_col_usecase_2](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\rtry_select_col_usecase_2.png){width=100%}

Since the default value of `showOverview` is set to be `TRUE`, the overview of the extracted data would be displayed in the console despite the argument `showOverview = TRUE` is not specified. The return data was assigned to the variable `TRYdata_selectNeighborColumns`.

<br>

## `rtry_select_row`

This function selects specified rows based on the specified criteria and `ObservationID` from the imported data for further processing.

```R
rtry_select_row(
  input = "",
  ...,
  getAuxiliary = FALSE,
  rmDuplicates = FALSE,
  showOverview = TRUE
)
```

| Argument       | Description                                                  |
| -------------- | ------------------------------------------------------------ |
| `input`        | Input data, imported by `rtry_import()` or in data table format |
| `...`          | Criteria for row selection                                   |
| `getAuxiliary` | Default `FALSE`, set to `TRUE` selects all auxiliary data based on the row selection criteria |
| `rmDuplicates` | Default `FALSE`, set to `TRUE`calls the `rtry_rmDuplicates()` function |
| `showOverview` | Default `TRUE` displays the dimension of the data after row selection |



**Example 1**

To select (or say filter) the rows where `TraitID` is larger than 0 (`TraitID > 0`) or where `DataID` is 59, 60, 61, 6601, 327, 413, 1961, 210 or 308 (`DataID %in% c(59, 60, 61, 6601, 327, 413, 1961, 210, 308)`) within the data `TRYdata_select_col`:

```R
TRYdata_selectRow <- rtry_select_row(TRYdata_selectColumns, (TraitID > 0) | (DataID %in% c(59, 60, 61, 6601, 327, 413, 1961, 210, 308)))
```

```R
## dim:    79918 17 
```

Since the default value of `showOverview` is set to be `TRUE`, the dimension of the filtered data would be displayed in the console despite the argument `showOverview = TRUE` is not specified. The return data was assigned to the variable `TRYdata_selectRow`.



**Example 2**

To select all `TraitID` that is `6` together with all the corresponding auxiliary data without any duplicates within the data `TRYdata`: 

```R
traitID6_auxiliary <- rtry_select_row(TRYdata, TraitID %in% c(6), getAuxiliary = TRUE, rmDuplicates = TRUE)
```

```R
## 2243 duplicates removed.
## dim:    110725 28 
```

![rtry_select_row_usecase_2](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\rtry_select_row_usecase_2.png){width=100%}

Since the default value of  `showOverview` is set to be `TRUE`, the dimension of the filtered data would be displayed in the console despite the argument `showOverview = TRUE` is not specified. The return data was assigned to the variable `TraitID6_Auxiliary`.



**Example 3**

To remove outliers, or say to select all interested auxiliary data and only the trait data with `ErrorRisk` smaller than 4:

```R
outlier_removal <- rtry_select_row(TRYdata, ErrorRisk < 4 | DataID %in% c(59, 60, 61, 6601, 327, 413, 1961, 210, 308))
```

```R
## dim:   77183 28 
```

![rtry_select_row_usecase_3](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\rtry_select_row_usecase_3.png){width=100%}

<br>

## `rtry_select_aux`

This function selects a list of unique `ObservationID` and the corresponding (specified) auxiliary data from the import data, and transform it into a wide table format for further processing.

```R
rtry_select_aux(input = "", name = "", showOverview = TRUE)
```

| Argument       | Description                                                  |
| -------------- | ------------------------------------------------------------ |
| `input`        | Input data, imported by `rtry_import()` or in data table format |
| `name`         | The name of auxiliary data (`DataName` in the TRY data) to be selected |
| `showOverview` | Default `TRUE` displays the dimension and the column names of the data after selection |



**Example 1**

To select (or say extract) a list of unique `ObservationID` and the corresponding auxiliary data of interested, such as "Latitude", from the data `TRYdata`:

```R
Latitude <- rtry_select_aux(TRYdata, Latitude)
```

```R
## dim:   11870 2 
## col:   ObservationID Latitude 
```

![rtry_select_aux_usecase_1](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\rtry_select_aux_usecase_1.png){width=20%}

Since the default value of `showOverview` is by default set to be `TRUE`, the dimension and the column names of the extracted data table is displayed in the console despite the argument `showOverview = TRUE` is not specified, and that the return data was assigned to the specified variable, which is `Latitude` in this case. It can also be seen that this data is in a wide table, and can be used easily for further processing such as merging the auxiliary data to the pre-processed data based on the `ObservationID`.

<br>

## `rtry_filter`

This function filters data from the input data based on the specified criteria and by default this filtering is performed based on the corresponding `ObservationID`. Therefore, if the column `ObservationID` has been removed, this function might not work (unless another attribute is defined when calling the function).

```R
rtry_filter(input = "", ..., baseOn = ObservationID, showOverview = TRUE)
```

| Argument       | Description                                                  |
| -------------- | ------------------------------------------------------------ |
| `input`        | Input data, imported by `rtry_import()` or in data table format |
| `...`          | Criteria for filtering based on `ObservationID`              |
| `baseOn`       | Default `ObservationID`, the parameter used for filtering the data |
| `showOverview` | Default `TRUE` displays the dimension of data table after filtering |



**Example 1**

To filter juveniles while excluding the whole Observation.

First, check the `DataID` that contains information about plant development status, i.e. `413`, then check the different states of the `OrigValueStr` using the functions `rtry_select_row()` and `rtry_explore()`.

```R
tmp <- rtry_select_row(TRYdata, DataID %in% 413)
```

```R
## dim:    907 28
```

![rtry_filter_usercase_1_01](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\rtry_filter_usercase_1_01.png){width=100%}

```R
tmp1 <- rtry_explore(tmp, OrigValueStr, OriglName, OrigUnitStr, StdValue, Comment)
```

```R
## dim:    7 6
```

![rtry_filter_usercase_1_02](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\rtry_filter_usercase_1_02.png){width=70%}

Once the filtering criteria are identified, perform the filtering using `rtry_filter()`. It is also possible to simply this step by using `rtry_filter_keyword()` in which only the keywords such as `juvenile` needs to be specified to perform the filtering.

```R
tmp2 <- rtry_filter(tmp, (DataID %in% 413) & (OrigValueStr %in% c("2.5", "juvenile", "Juvenile", "juvenile, 6 weeks")))
```

```R
## dim:    52 28 
```

![rtry_filter_usercase_1_03](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\rtry_filter_usercase_1_03.png){width=100%}

```R
tmp3 <- rtry_explore(tmp2, OrigValueStr, OriglName, OrigUnitStr, StdValue, Comment)
```

```R
## dim:    2 6
```

![rtry_filter_usercase_1_04](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\rtry_filter_usercase_1_04.png){width=70%}



Since the default value of `showOverview` are set to be `TRUE`, the dimension of data table after each step would be displayed in the console despite the argument `showOverview = TRUE` is not specified, and that the return data was assigned to the specified variables.



**Example 2**

To exclude the data with incorrect units, the parameter `ObsDataID` needs to be specified:

```R
tmp <- rtry_filter(TRYdata, (TraitID == 3116  & UnitName != "mm2 mg-1") |
                               (TraitID == 144  & UnitName != "mm") |
                               (TraitID == 3107  & UnitName != "m") |
                               (TraitID == 21  & UnitName != "m") |
                               (TraitID == 4  & UnitName != "g/cm3"), baseOn = ObsDataID, showOverview = FALSE)
```

Since the `showOverview` in this example is set to `FALSE`, the overview of the data would not be displayed in the console.

<br>

## `rtry_filter_keyword`

This function filters data from the input data based on the specified keywords and the corresponding `ObservationID`. Therefore, if the column `ObservationID` has been removed, this function will not work.

```R
rtry_filter_keyword(
  input = "",
  attribute = NULL,
  ...,
  caseSensitive = TRUE,
  exactMatch = TRUE,
  showOverview = TRUE
)
```

| Argument        | Description                                                  |
| --------------- | ------------------------------------------------------------ |
| `input`         | Input data, imported by `rtry_import()` or in data table format |
| `attribute`     | Attribute (column name) for filtering                        |
| `...`           | Values (keywords) for filtering                              |
| `caseSensitive` | Default `TRUE` performs case-sensitive filtering             |
| `exactMatch`    | Default `TRUE` performs exact match filtering, overrides all conflicting arguments |
| `showOverview`  | Default `TRUE` displays the dimension of data table after filtering |



**Example 1**

To filter juveniles while excluding the whole Observation.

First, check the `DataID` that contains information about plant development status, i.e. `413`, then check the different states of the `OrigValueStr` using the functions `rtry_select_row()` and `rtry_explore()`.

```R
tmp <- rtry_select_row(TRYdata, DataID %in% 413)
```

```R
## dim:    907 28
```

![rtry_filter_usercase_1_01](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\rtry_filter_usercase_1_01.png){width=100%}

```R
tmp1 <- rtry_explore(tmp, OrigValueStr, OriglName, OrigUnitStr, StdValue, Comment)
```

```R
## dim:    7 6
```

![rtry_filter_usercase_1_02](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\rtry_filter_usercase_1_02.png){width=70%}

Once the filtering criteria are identified, perform the filtering using `rtry_filter_keyword()`.

(a) Manually enters the values for exact match (by default also case sensitive) filtering, which works as if `rtry_filter()` is used:

```R
tmp2 <- rtry_filter_keyword(tmp, OrigValueStr, c("2.5", "juvenile", "Juvenile", "juvenile, 6 weeks"))
```

```R
## dim:    52 28 
```

(b) Filtering with case-insensitive keywords:

```R
tmp3 <- rtry_filter_keyword(tmp, OrigValueStr, c("2.5", "juvenile"), caseSensitive = FALSE, exactMatch = FALSE)
```

```R
## dim:    52 28 
```

Note that both (a) and (b) output the same results in this case, with only the data where `OrigValueStr` equals to `mature` or `Mature` remaining.

![rtry_filter_usercase_1_03](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\rtry_filter_usercase_1_03.png){width=100%}

```R
tmp4 <- rtry_explore(tmp3, OrigValueStr, OriglName, OrigUnitStr, StdValue, Comment)
```

```R
## dim:    2 6
```

![rtry_filter_usercase_1_04](C:\Users\hlam\ownCloud\TRY_R\rtry\doc\image\rtry_filter_usercase_1_04.png){width=70%}



Since the default value of `showOverview` are set to be `TRUE`, the dimension of data table after each step would be displayed in the console despite the argument `showOverview = TRUE` is not specified, and that the return data was assigned to the specified variables.

<br>

## `rtry_rm_col`

This function removes the specified columns from the input data for further processing. This function can be viewed as an alternatives than `rtry_select_col()`.

```R
rtry_rm_col(input = "", ..., showOverview = TRUE)
```

| Argument       | Description                                                  |
| -------------- | ------------------------------------------------------------ |
| `input`        | Input data, imported by `rtry_import()` or in data table format |
| `...`          | Column names to be removed                                   |
| `showOverview` | Default `TRUE` displays the dimension of data table after removal |



**Example 1**

To remove the columns `LastName`, `FirstName`, `DatasetID`, `Dataset`, `SpeciesName`, `OrigUncertaintyStr`, `UncertaintyName`, `Replicates`, `RelUncertaintyPercent`, `Reference`, `V28` from `TRYdata`:

```R
TRYdata_rmColumns <- rtry_rm_col(TRYdata, LastName, FirstName, DatasetID, Dataset, SpeciesName, OrigUncertaintyStr, UncertaintyName, Replicates, RelUncertaintyPercent, Reference, V28)
```

```R
## dim:    435764 17 
## col:   AccSpeciesID AccSpeciesName ObservationID ObsDataID TraitID TraitName DataID DataName OriglName OrigValueStr OrigUnitStr ValueKindName StdValue UnitName OrigObsDataID ErrorRisk Comment 
```

Note that the resulting data table would be the same as in the example provided in `rtry_select_col()` in this case.

Since the default value of `showOverview` is set to be `TRUE`, the overview of the data after removal would be displayed in the console despite the argument `showOverview = TRUE` is not specified, and that the return data was assigned to the variable `TRYdata_rmColumns`.

<br>

## `rtry_rm_dup`

This function identifies and removes the duplicates from the input data. Once the function is called and executed, the number of duplicates removed will be displayed on the console as reference.

Note that this function depends on the duplicate identifier `OrigObsDataID` listed in the TRYdata, therefore, if the column `OrigObsDataID` has been removed, this function will not work. Also,  if the imported TRYdata contains restricted dataset that belongs to another dataset (i.e. having an `OrigObsDataID`), these restricted data will also be removed resulting in data loss.

```R
rtry_rm_dup(input = "", showOverview = TRUE)
```

| Argument       | Description                                                  |
| -------------- | ------------------------------------------------------------ |
| `input`        | Input data, imported by `rtry_import()` or in data table format |
| `showOverview` | Default `TRUE` displays the dimension of data table after removal |



**Example 1**

To remove the duplicates within `TRYdata_selectRow`:

```R
tmp_rmDuplicates <- rtry_rm_dup(TRYdata_selectRow)
```

```R
## 6726 duplicates removed.
## dim:    73192 17 
```

Since the default value of `showOverview` is set to be `TRUE`, the dimension of data table after removal would be displayed in the console despite the argument `showOverview = TRUE` is not specified, and that the return data was assigned to the variable `tmp_rmDuplicates`.

<br>

## `rtry_trans_wider`

This function transforms a long table into wide table, i.e. increasing the number of columns and decreasing the number of rows. For details, please refer to `tidyr::pivot_wider()`.

```R
rtry_trans_wider(
  input = "",
  names_from = NULL,
  values_from = NULL,
  values_fn = NULL,
  showOverview = TRUE
)
```

| Argument       | Description                                                  |
| -------------- | ------------------------------------------------------------ |
| `input`        | Input data, imported by `rtry_import()` or in data table format |
| `names_from`   | The column(s) from which the output column names to be obtained |
| `values_from`  | The column(s) from which the output values to be obtained    |
| `values_fn`    | (Optional) Function to be applied to the output values       |
| `showOverview` | Default `TRUE` displays the dimension of the result data table |

<br>

## `rtry_export`

This function exports the pre-processed data as a CSV file. If the specified output directory does not exist, it will be created.

```R
rtry_export(data = "", output = "", quote = TRUE, encoding = "UTF-8")
```

| Argument   | Description                                                  |
| ---------- | ------------------------------------------------------------ |
| `data`     | The data to be saved                                         |
| `output`   | Output path                                                  |
| `quote`    | Default `TRUE` inserts double quotes around any character or factor columns |
| `encoding` | File encoding. Default `"UTF-8"`                             |



**Example 1**

To save the data `TRYdata1_explore` as `"output/Traits_auxilliary_Data_rtry.csv"`:

```R
rtry_export(TRYdata1_explore, "output/Traits_auxilliary_Data_rtry.csv")
```

```R
## New directory created at:  output 
## File saved at:  output/Traits_auxilliary_Data_rtry.csv 
```

Since the specified output directory does not exist in this case, it was created before saving the data into the CSV file.

<br>

## `rtry_geocoding`

This function uses Nominatim, a search engine for OpenStreetMap data, to perform geocoding, i.e. converting an address into coordinates (latitudes, longitudes). For details, please refer to: https://wiki.openstreetmap.org/wiki/Nominatim.

```R
rtry_geocoding(address = NULL, email = NULL)
```

| Argument  | Description                |
| --------- | -------------------------- |
| `address` | String of an address       |
| `email`   | String of an email address |



**Example 1**

To convert the address of MPI-BGC (`"Hans-Knoell-Strasse 10, 07745 Jena, Germany"`) into coordinates in latitudes and longitudes:

```R
rtry_geocoding("Hans-Knoell-Strasse 10, 07745 Jena, Germany", email = "jens.kattge@bgc-jena.mpg.de")
```

```R
##        lat      lon
## 1 50.91012 11.56674
```



An example workflow of how to use `rtry_geocoding()` for a list of locations or in a `.csv` file can be viewed in the vignette:

```R
vignette("rtry-workflow-geocoding")
```

<br>

## `rtry_revgeocoding`

This function uses Nominatim, a search engine for OpenStreetMap data, to perform reverse geocoding, i.e. converting coordinates (latitudes, longitudes) into an address. For details, please refer to: https://wiki.openstreetmap.org/wiki/Nominatim.

```R
rtry_revgeocoding(lat_lon = NULL, email = NULL)
```

| Argument  | Description                                    |
| --------- | ---------------------------------------------- |
| `lat_lon` | A data frame consisting latitude and longitude |
| `email`   | String of an email address                     |



**Example 1**

To convert the coordinates (`data.frame(50.91012, 11.56674)`) into an address:

```R
rtry_revgeocoding(data.frame(50.91012, 11.56674), email = "jens.kattge@bgc-jena.mpg.de")
```

```R
##               full_address town city country country_code
## 1 Jena, Thuringia, Germany   NA Jena Germany           de
```



An example workflow of how to use `rtry_revgeocoding()` for a list of coordinates or in a `.csv` file can be viewed in the vignette:

```R
vignette("rtry-workflow-geocoding")
```



<br>

***

# Data license

The TRY database is open source under a Creative Commons Attribution license (CC BY 4.0, https://creativecommons.org/licenses/by/4.0): anyone can use and redistribute data received via TRY under the only condition of appropriate citation of the TRY database and the references of contributing data sets.

The `rtry` package is also distributed under the CC BY 4.0 license, with a remark that the (reverse) geocoding functions provided within the package used the Nominatim developed with OpenStreetMap. Despite the API and the data provided are free to use for any purpose, including commercial use, note that they are governed by the ODbL (https://wiki.osmfoundation.org/wiki/Licence).

<br>

***

# Authorship guidelines

The standard reference of the TRY database is currently:

Kattge, J., Bönisch, G., Díaz, S., Lavorel, S., Prentice, I. C., Leadley, P., Tautenhahn, S., Werner, G., et al. (2020). TRY plant trait database - enhanced coverage and open access. Global Change Biology, 26(1), 119-188. doi:10.1111/gcb.14904.



> reference for the rtry package
